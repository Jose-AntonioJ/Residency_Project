<!-- Versión actualizada del HTML con clases mejoradas -->

<div class="container">
    <h1 style="background-color: black;">ASPERSOR</h1>

    <mat-stepper [linear]="isLinear" #stepper>
        <mat-step [stepControl]="firstFormGroup">
            <form [formGroup]="firstFormGroup">
                <ng-template matStepLabel>Coordenadas</ng-template>

                <!-- Coordenadas X organizadas en fila -->
                <div class="coordinates-row">
                    <mat-form-field appearance="fill">
                        <mat-label>Eje inicial X</mat-label>
                        <input matInput placeholder="Agrega el valor" formControlName="ejeInicioX" required>
                        <mat-icon matSuffix>straighten</mat-icon>
                    </mat-form-field>

                    <mat-form-field appearance="fill">
                        <mat-label>Eje final X</mat-label>
                        <input matInput placeholder="Agrega el valor" formControlName="ejeFinalX" required>
                        <mat-icon matSuffix>straighten</mat-icon>
                    </mat-form-field>
                </div>

                <!-- Coordenadas Y organizadas en fila -->
                <div class="coordinates-row">
                    <mat-form-field appearance="fill">
                        <mat-label>Eje inicial Y</mat-label>
                        <input matInput placeholder="Agregar el valor" formControlName="ejeInicioY" required>
                        <mat-icon matSuffix>height</mat-icon>
                    </mat-form-field>

                    <mat-form-field appearance="fill">
                        <mat-label>Eje final Y</mat-label>
                        <input matInput placeholder="Agregar el valor" formControlName="ejeFinalY" required>
                        <mat-icon matSuffix>height</mat-icon>
                    </mat-form-field>
                </div>

                <!-- Eje Z -->
                <mat-form-field appearance="fill">
                    <mat-label>Eje Z (Altura)</mat-label>
                    <input matInput placeholder="Ingresa el valor de altura" formControlName="ejeZ" required>
                    <mat-icon matSuffix>vertical_align_top</mat-icon>
                </mat-form-field>

                <div class="action-buttons">
                    <button mat-raised-button color="primary" matStepperNext [disabled]="trayectoriaEnviada">
                        <mat-icon>navigate_next</mat-icon>
                        Siguiente
                    </button>
                </div>
            </form>
        </mat-step>

        <!-- Paso de Aspersión -->
        <mat-step [stepControl]="secondFormGroup">
            <form [formGroup]="secondFormGroup">
                <ng-template matStepLabel>Aspersión</ng-template>

                <div class="coordinates-row">
                    <mat-form-field appearance="fill">
                        <mat-label>Flujo</mat-label>
                        <mat-select formControlName="flujo">
                            <mat-option *ngFor="let flujo of flujos" [value]="flujo.value">
                                {{ flujo.viewValue }}
                            </mat-option>
                        </mat-select>
                        <mat-icon matSuffix>water_drop</mat-icon>
                    </mat-form-field>

                    <mat-form-field appearance="fill">
                        <mat-label>Velocidad</mat-label>
                        <mat-select formControlName="velocidad">
                            <mat-option *ngFor="let velocidad of velocidades" [value]="velocidad.value">
                                {{ velocidad.viewValue }}
                            </mat-option>
                        </mat-select>
                        <mat-icon matSuffix>speed</mat-icon>
                    </mat-form-field>
                </div>

                <mat-form-field appearance="fill">
                    <mat-label>Cobertura</mat-label>
                    <input matInput type="number" formControlName="cobertura" required>
                    <mat-icon matSuffix>crop</mat-icon>
                </mat-form-field>

                <div class="action-buttons">
                    <button mat-button matStepperPrevious [disabled]="trayectoriaEnviada">
                        <mat-icon>navigate_before</mat-icon>
                        Atrás
                    </button>
                    <button mat-raised-button color="primary" matStepperNext [disabled]="trayectoriaEnviada">
                        <mat-icon>navigate_next</mat-icon>
                        Siguiente
                    </button>
                </div>
            </form>
        </mat-step>

        <!-- Paso 3 tiempo y capas -->
        <mat-step [stepControl]="threeFormGroup">
            <form [formGroup]="threeFormGroup">
                <ng-template matStepLabel>Configuración</ng-template>



                <div></div>

                <mat-form-field appearance="fill">
                    <mat-label>Capas de recubrimiento</mat-label>
                    <mat-select formControlName="pasadas">
                        <mat-option *ngFor="let capa of capas" [value]="capa.value">
                            {{ capa.viewValue }}
                        </mat-option>
                    </mat-select>
                    <mat-icon matSuffix>layers</mat-icon>
                </mat-form-field>

                <div class="action-buttons">
                    <button mat-button matStepperPrevious [disabled]="trayectoriaEnviada">
                        <mat-icon>navigate_before</mat-icon>
                        Atrás
                    </button>
                    <button mat-raised-button color="primary" (click)="enviarTrayectoria()"
                        [disabled]="trayectoriaEnviada">
                        <mat-icon>send</mat-icon>
                        Enviar Trayectoria
                    </button>
                </div>
            </form>
        </mat-step>

        <!-- Paso 4 iniciar -->
        <mat-step [stepControl]="fourFormGroup">
            <form [formGroup]="fourFormGroup">
                <ng-template matStepLabel>Control</ng-template>

                <div *ngIf="trayectoriaEnviada" class="tiempos">
                    <p>Tiempo estimado por pasada: {{ tiempoPasada }} min</p>
                    <p>Tiempo estimado total: {{ tiempoTotal }} min</p>
                </div>

                <mat-form-field appearance="fill">
                    <mat-label>Tiempo de riego (minutos)</mat-label>
                    <input matInput type="number" min="1" formControlName="duracion" [(ngModel)]="selecciondeMinutos"
                        required>
                    <mat-icon matSuffix>schedule</mat-icon>
                </mat-form-field>

                <div class="action-buttons">
                    <button mat-raised-button color="accent" (click)="iniciarAspersion()">
                        <mat-icon>play_arrow</mat-icon>
                        Iniciar Aspersión
                    </button>

                    <button mat-raised-button color="warn" (click)="pausarReanudar()" *ngIf="tiempodeEjecucion">
                        <mat-icon>{{ enPausa ? 'play_arrow' : 'pause' }}</mat-icon>
                        {{ enPausa ? 'Continuar' : 'Pausar' }}
                    </button>

                    <button mat-raised-button color="warn" (click)="detenerAspersion()" *ngIf="tiempodeEjecucion">
                        <mat-icon>stop</mat-icon>
                        Detener
                    </button>
                </div>
            </form>
        </mat-step>
    </mat-stepper>

    <div *ngIf="tiempodeEjecucion" class="tiempo-restante">
        <mat-icon>schedule</mat-icon>
        Tiempo restante: {{ tiempoFormateado }}
    </div>

    <app-cartesian-plane #plano></app-cartesian-plane>

</div>